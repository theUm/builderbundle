{% extends 'BuilderBundle:default:base.object.fields.html.twig' %}

{% block content %}
    {{ parent() }}
    <div class="sixteen wide column">
        {{ block('crud_modal') }}
        <div class="ui grid">
            {# left sidebar menu #}
            <div class="ui four wide column vertical pointing secondary tabular menu">
                <a class="active item"
                   data-tab="main_object_form"><b>{{ 'Редактировать \"%name\"'|trans({'%name' : objectEntity.name})|raw }}</b></a>
                <div class="ui divider"></div>
                {% for childType in objectEntity.entityType.childTypes if not childType.dataType %}
                    <a class="item" data-tab="{{ 'child_type_'~childType.slug }}">{{ childType.name }}</a>
                {% endfor %}
            </div>
            {# /left sidebar menu #}

            <div class="twelve wide stretched column">
                {# left sidebar menu main object tab #}
                <div class="ui twelve wide tab segment active" data-tab="main_object_form">
                    {% if objectEntity.entityType.dataType %}
                        <h1 class="ui header">{{ "Редактировать объект для данных типа <b>\"%type\"</b>"|trans({'%type' : objectEntity.entityType.name})|raw }}</h1>
                    {% else %}
                        <h1 class="ui header">{{ "Редактировать объект \"%name\" типа [%type]"|trans({'%name' : objectEntity.name, '%type' : objectEntity.entityType.name})|raw }}</h1>
                    {% endif %}
                    {{ form_start(form) }}
                    {% if not objectEntity.entityType.dataType %}
                        {{ form_row(form.name) }}
                        {{ form_row(form.slug) }}
                    {% endif %}
                    {% do form.submit_button.setRendered %}
                    {{ block('form_tabable_dropdown') }}
                    {{ form_end(form) }}

                    {# childTypes #}
                    {% if not objectEntity.entityType.isDataType %}
                        <div class="ui accordion field">
                            {% for childType in objectEntity.entityType.childTypes if childType.dataType %}
                                {% set accordion_title = childType.name %}
                                {{ block('accordion_title_ajax_form') }}
                                <div class="content field">
                                    <div class="ui bottom attached tab segment grid"
                                         data-change-tab="{{ childType.slug }}">
                                        <div class="ui grid">
                                            <div class="ui three wide stretched column">
                                                <div class="ui text">{{ 'Выбрать "%typeName%"'|trans({'%typeName%':childType.name}) }}</div>
                                            </div>
                                            {# existed objects dropdown select #}
                                            <div class="ui nine wide stretched column">
                                                <div class="ui fullwidth child-object tabable search selection dropdown">
                                                    <input type="hidden" name="actions" value="">
                                                    <div class="text"></div>
                                                    <i class="dropdown icon"></i>
                                                    <div class="menu">
                                                        {% if childType.id in relatedObjects|keys %}
                                                            {% for childObject in relatedObjects[childType.id] %}
                                                                <div class="item"
                                                                     data-change-tab="{{ 'obj_'~childType.slug~'_'~childObject.id }}"
                                                                     data-url="{{ path('builder_edit_object',{ 'id': childObject.id}) }}"
                                                                >{{ childType.name ~ ' ' ~ childObject.id }}</div>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ui four wide stretched column">
                                                <div id="{{ 'obj_'~childType.slug~'_new' }}" class="item"
                                                     data-change-tab="{{ 'obj_'~childType.slug~'_new' }}">
                                                    <button class="ui icon button"><i
                                                                class="icon plus"></i>{{ 'Добавить'|trans({'%typeName%':childType.name}) }}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        {% if childType.id in relatedObjects|keys %}
                                            {% for childObject in relatedObjects[childType.id] %}
                                                <div class="ui bottom attached tab segment"
                                                     data-change-tab="{{ 'obj_'~childType.slug~'_'~childObject.id }}"
                                                     data-url="{{ path('builder_edit_object',{ 'id': childObject.id}) }}"></div>
                                            {% endfor %}
                                        {% endif %}
                                        <div class="ui bottom attached tab segment"
                                             data-change-tab="{{ 'obj_'~childType.slug~'_new' }}"
                                             data-url="{{ path('builder_add_type_object',{ 'id': childType.id, 'parentObjId': objectEntity.id}) }}"
                                             data-new="true"></div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {{ form(delete_form) }}
                </div>
                {# /left sidebar menu main object tab #}
                {# left menu parent tabs #}
                {% for childType in objectEntity.entityType.childTypes if not childType.dataType %}
                    <div class="ui dynamic twelve wide tab segment" data-tab="{{ 'child_type_'~childType.slug }}"
                         data-url-template="{{ path('builder_edit_object',{ 'id': 0}) }}">
                        <div class="ui top attached tabular menu">
                            {% if childType.id in relatedObjects|keys %}
                                {% for childObject in relatedObjects[childType.id] %}
                                    <div class="item"
                                         data-tab="{{ 'obj_'~childType.slug~'_'~childObject.id }}">{{ childObject.name }}</div>
                                {% endfor %}
                            {% endif %}
                            <div id="{{ 'obj_'~childType.slug~'_new' }}" class="item"
                                 data-tab="{{ 'obj_'~childType.slug~'_new' }}">
                                <i class="icon plus"></i>
                            </div>
                        </div>
                        {% if childType.id in relatedObjects|keys %}
                            {% for childObject in relatedObjects[childType.id] %}
                                <div class="ui bottom attached bottom-padded tab segment"
                                     data-tab="{{ 'obj_'~childType.slug~'_'~childObject.id }}"
                                     data-url="{{ path('builder_edit_object',{ 'id': childObject.id}) }}"></div>
                            {% endfor %}
                        {% endif %}
                        <div class="ui bottom attached tab segment"
                             data-tab="{{ 'obj_'~childType.slug~'_new' }}"
                             data-url="{{ path('builder_add_type_object',{ 'id': childType.id, 'parentObjId': objectEntity.id}) }}"
                             data-new="true"></div>
                    </div>
                {% endfor %}
                {# /left menu parent tabs #}
                <div class="ui row">
                    <a class="ui left floated button" href="{{ path('builder_add_types',{}) }}">Назад</a>
                    {% if not objectEntity.entityType.isDataType %}
                        <a href="{{ path('vSingleObject',{'entityType':objectEntity.entityType.slug, 'object': objectEntity.slug}) }}"
                           class="ui right floated green button" target="_blank">{{ 'Страница объекта'|trans }}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block crud_modal_header %}
    {{- "Удалить обьект?"|trans -}}
{% endblock %}

{% block crud_modal_content %}
    <p>{{ "Удалив обьект вы также удалите ВСЕ значения полей этого обьекта. Cвязанные с другими обьектами поля не будут удалены. Действие необратимо!"|trans }}</p>
{% endblock %}
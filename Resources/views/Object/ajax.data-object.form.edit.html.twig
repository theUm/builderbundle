{% use 'BuilderBundle:Object:base.object.fields.html.twig' %}
{% spaceless %}
    {% set method = form.vars.method|upper %}
    {%- if method in ["GET", "POST"] -%}
        {% set form_method = method %}
    {%- else -%}
        {% set form_method = "POST" %}
    {%- endif -%}
    {% set attr = form.vars.attr|merge({'class': form.vars.attr.class|default('ui form'), 'id':''}) %}

    {%- if not form.vars.valid -%}
        {% set attr = attr|merge({'class': attr.class|default('') ~ ' error'}) %}
    {% endif %}
    <form name="{{ form.vars.name }}"
    method="{{ form_method|lower }}"{% if form.vars.action != '' %} action="{{ form.vars.action }}"{% endif %}{% for attrname, attrvalue in attr %} {{ attrname }}="{{ attrvalue }}"{% endfor -%}
    {%- if form.vars.multipart %} enctype="multipart/form-data"{% endif -%}
    {% set dataId = '' %}
    {% if objectNodeId is defined and objectNodeId is not empty %}{% spaceless %}{% set dataId = objectNodeId %}
        data-id="{{ objectNodeId }}" data-url="{{ path('builder_edit_object',{'id':objectNodeId}) }}" {% if not entityType.isDataType %}data-name="{{ form.name.vars.value }}"{% endif %}
    {% endspaceless %}{% endif %}>
    {%- if form_method != method -%}
        <input type="hidden" name="_method" value="{{ method }}"/>
    {%- endif -%}
    {%- if not entityType.isDataType %}
        {{ form_row(form.name) }}
        {{ form_row(form.slug) }}
        {{ form_row(form.description) }}
        {{ form_row(form.isCommentable) }}
        <div class="ui fullwidth tabable search selection dropdown ui-dynamic-dropdown">
            <input type="hidden" name="actions" value="{{ fieldsByGroups|keys|first|default('Связи и шаблон'|trans) }}">
            <i class="dropdown icon"></i>
            <div class="text">{{ fieldsByGroups|keys|first|default('Связи и шаблон'|trans) }}</div>
            <div class="menu">
                {% for groupName, fields in fieldsByGroups %}
                    <div class="item {% if loop.first %} active{% endif %}"
                         data-change-tab="{{ groupName }}">{{ groupName }}</div>
                {% endfor %}
                <div class="item {% if fieldsByGroups is empty %} active{% endif %}"
                     data-change-tab="__links">{{ 'Связи и шаблон'|trans }}</div>
            </div>
        </div>
        {% for groupName, fields in fieldsByGroups %}
            <div class="ui bottom attached tab segment{% if loop.first %} active{% endif %}"
                 data-change-tab="{{ groupName }}">
                {% for groupName, field in fields %}
                    {{ form_row(form[field['type'].id]) }}
                    {{ form_errors(form[field['type'].id]) }}
                {% endfor %}
            </div>
        {% endfor %}
        <div class="ui bottom attached tab segment{% if fieldsByGroups is empty %} active{% endif %}"
             data-change-tab="__links">
            {{ form_rest(form) }}
        </div>
    {% else %}
        {{ form_rest(form) }}
    {% endif %}
    {{ block('accordion_content_save_button') }}
    {{ block('accordion_content_delete_button') }}
    {{ form_end(form) }}
    {% if delete_form is defined %}
        {{ form(delete_form) }}
    {% endif %}
{% endspaceless %}